(()=>{"use strict";var e=document.querySelector(".cards"),t=document.querySelector("#card").content;function n(n,o,r,c,a){e.prepend(function(e,n,o,r,c){var a=t.querySelector(".cards__card").cloneNode(!0),s=a.querySelector(".cards__image");return s.src=n,s.alt=e,a.querySelector(".cards__like-counter").textContent=o,a.querySelector(".cards__name").textContent=e,a.querySelector(".cards__id").textContent=r,c&&a.querySelector(".cards__trash").remove(),a}(n,o,r,c,a))}function o(e,t,n,o){o.textContent=e?t:n}document.querySelector(".cards__card"),document.querySelector(".cards__like-counter");var r={server:"https://nomoreparties.co/v1/plus-cohort-22/",headers:{authorization:"d49dae7b-52fd-4787-ad1c-63454d12ebd1","Content-Type":"application/json"}},c=document.querySelector(".popup__caption"),a=document.getElementById("mesto"),s=document.getElementById("link"),u=document.getElementById("image_popup"),i=u.querySelector(".popup__image"),d=document.querySelector(".profile__name"),l=document.querySelector(".profile__profession"),m=document.getElementById("name"),_=document.getElementById("profession"),p=document.getElementsByName("mesto"),f=document.getElementsByName("link"),v=document.getElementById("popup__submit_add"),y=document.getElementById("image_popup_close"),h=document.getElementById("edit_popup_close"),g=document.getElementById("add_popup"),E=document.getElementById("edit_popup"),k=document.getElementById("add_popup_close"),S=document.getElementById("avatar_popup"),L=document.getElementById("avatar_popup_close"),C=document.getElementById("avatarLink"),b=document.querySelector(".profile__avatar"),q=document.querySelector(".popup__submit"),B=document.getElementById("popup__submit_avatar"),x=document.getElementById("popup__submit_add"),I=(document.querySelector(".popup"),document.getElementById("popup__submit_avatar"));function j(e){e.classList.add("popup_opened"),document.addEventListener("keydown",T)}function P(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",T)}function T(e){"Escape"===e.key&&P(document.querySelector(".popup_opened"))}var A,D=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},N=document.querySelector(".profile__edit-button"),M=document.querySelector(".profile__add-button"),w=document.querySelector(".profile__avatar"),H=document.querySelector(".popup__form"),O=document.getElementById("popup__form_add"),J=document.getElementById("avatar_popup"),G=document.querySelector(".profile__avatar");fetch(r.server+"users/me",{method:"GET",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){d.textContent=e.name,l.textContent=e.about,G.src=e.avatar})).catch((function(e){console.log(e)})),O.addEventListener("submit",(function(e){var t,c;e.preventDefault(),p.textContent=a.value,f.src=s.value,(t=p.textContent,c=f.src,o(!0,"Создание...","Создать",x),fetch(r.server+"cards",{method:"POST",headers:r.headers,body:JSON.stringify({name:t,link:c})})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){n(p.textContent,f.src,0,t._id),P(g),e.target.reset(),v.classList.add("popup__submit_disabled"),v.disabled=!0})).catch((function(e){console.log(e)})).finally((function(){o(!1,"Создание...","Создать",x)}))})),fetch(r.server+"cards",{method:"GET",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){e.owner.name===d.textContent&&e.owner.about===l.textContent?n(e.name,e.link,e.likes.length,e._id):n(e.name,e.link,e.likes.length,e._id,!0),e.likes.map((function(e){return e._id})).includes("e871dc8690cbbaff627df173")?document.querySelector(".cards__like").classList.add("cards__like_active"):document.querySelector(".cards__like").classList.remove("cards__like_active")}))})).catch((function(e){console.log(e)})),e.addEventListener("click",(function(e){var t,n,o,a=e.target.closest(".cards__card").querySelector(".cards__id"),s=e.target.closest(".cards__card").querySelector(".cards__like-counter");e.target.classList.contains("cards__like")&&!e.target.classList.contains("cards__like_active")?((t=a.textContent,fetch(r.server+"cards/likes/"+"".concat(t),{method:"PUT",headers:r.headers})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){s.innerHTML=e.likes.length})).catch((function(e){console.log(e)})),e.target.classList.add("cards__like_active")):e.target.classList.contains("cards__like_active")&&(function(e){return fetch(r.server+"cards/likes/"+"".concat(e),{method:"DELETE",headers:r.headers})}(a.textContent).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){s.innerHTML=e.likes.length})).catch((function(e){console.log(e)})),e.target.classList.remove("cards__like_active")),e.target.classList.contains("cards__trash")&&function(e){return fetch(r.server+"cards/"+"".concat(e),{method:"DELETE",headers:r.headers})}(e.target.closest(".cards__card").querySelector(".cards__id").textContent).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).then((function(){e.target.closest(".cards__card").remove()})).catch((function(e){console.log(e)})),e.target.classList.contains("cards__image")&&(n=e.target.alt,o=e.target.src,i.src=o,i.alt=n,c.textContent=n,j(u))})),y.addEventListener("click",(function(){P(u)})),h.addEventListener("click",(function(){P(E)})),k.addEventListener("click",(function(){P(g)})),L.addEventListener("click",(function(){P(S)})),N.addEventListener("click",(function(){j(E),m.value=d.textContent,_.value=l.textContent})),M.addEventListener("click",(function(){j(g)})),w.addEventListener("click",(function(){j(S)})),Array.from(document.querySelectorAll(".popup")).forEach((function(e){!function(e){e.addEventListener("click",(function(t){t.currentTarget===t.target&&P(e)}))}(e)})),H.addEventListener("submit",(function(e){var t,n;e.preventDefault(),(t=m.value,n=_.value,o(!0,"Сохранение...","Сохранить",q),fetch(r.server+"users/me",{method:"PATCH",headers:r.headers,body:JSON.stringify({name:t,about:n})})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(){d.textContent=m.value,l.textContent=_.value,P(E)})).catch((function(e){console.log(e)})).finally((function(){o(!1,"Сохранение...","Сохранить",q)}))})),J.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=C.value,o(!0,"Сохранение...","Сохранить",B),fetch(r.server+"users/me/avatar",{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})})).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).then((function(){b.src=C.value,e.target.reset(),I.classList.add("popup__submit_disabled"),v.disabled=!0,P(S)})).catch((function(e){console.log(e)})).finally((function(){o(!1,"Сохранение...","Сохранить",B)}))})),A={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input_error-active"},Array.from(document.querySelectorAll(A.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);D(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),D(n,o,t)}))}))}(e,A)}))})();